services:
  aiclient2api:
    build: .
    container_name: aiclient2api
    restart: always
    privileged: true
    ports:
      - "3000:3000"
      - "8085:8085"
      - "8086:8086"
    environment:
      - TZ=Asia/Shanghai
      - ARGS=--api-key 123456 --host 0.0.0.0 --port 3000
    volumes:
      # 将宿主的 AWS SSO 缓存目录挂载到容器内。
      # - /app/.aws/sso/cache：用于 --kiro-oauth-creds-file /app/... 的场景（见 DOCKER-QUICKSTART.md）
      # - /root/.aws/sso/cache：用于默认读取 os.homedir()/HOME 的场景
      - ${AWS_SSO_CACHE_DIR:-${HOME}/.aws/sso/cache}:/app/.aws/sso/cache:rw
      - ${AWS_SSO_CACHE_DIR:-${HOME}/.aws/sso/cache}:/root/.aws/sso/cache:rw
      - /etc/localtime:/etc/localtime:ro
    healthcheck:
      test: ["CMD", "node", "healthcheck.js"]
      interval: 30s
      timeout: 3s
      start_period: 5s
      retries: 3
